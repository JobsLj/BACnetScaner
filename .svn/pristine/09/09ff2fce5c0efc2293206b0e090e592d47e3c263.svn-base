using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Windows;

namespace BACnetScanBIM
{
    /// <summary>
    /// App.xaml 的交互逻辑
    /// </summary>
    public partial class App : Application
    {
        protected override void OnStartup(StartupEventArgs e)
        {
            base.OnStartup(e);

            if (string.Equals(ConfigurationManager.AppSettings["OnlyConsole"], "True", StringComparison.CurrentCultureIgnoreCase))
            {
                Logger.Log("Console Start");
                MainVM.Instance.Run();
                Console.WriteLine("Press Enter to Begin Scan");
                Console.ReadLine();
                Logger.Log("Begin Scan Device");
                var deviceList = MainVM.Instance.DevicesList;
                foreach (var device in deviceList)
                {
                    var count = MainVM.Instance.GetDeviceArrayIndexCount(device);
                    MainVM.Instance.ScanPointsBatch(device, count);
                }
                Logger.Log("Begin Scan Properties");
                foreach (var device in deviceList)
                {
                    MainVM.Instance.ScanSubProperties(device);
                }
                Logger.Log("Scan Success");
                Console.WriteLine("Press Enter to Save Excel");
                Console.ReadLine();
                MainVM.Instance.Save2Excel();
                Logger.Log("Save2Excel Success");
            }
            else
            {
                var win = new MainWindow();
                win.Show();
            }
        }
    }
}
